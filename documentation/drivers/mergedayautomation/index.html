<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Merge Day Automation | Thunderbird Release Documentation</title>
<link href="../../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#2284fe">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://jfx2006.github.io/thunderbird-release/documentation/drivers/mergedayautomation/">
<link rel="favicon" href="../../../favicon.ico" sizes="48x48">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Thunderbird Release Team">
<meta property="og:site_name" content="Thunderbird Release Documentation">
<meta property="og:title" content="Merge Day Automation">
<meta property="og:url" content="https://jfx2006.github.io/thunderbird-release/documentation/drivers/mergedayautomation/">
<meta property="og:description" content="Overview
Merge day happens at 4-week intervals (most of the time), and follows the
Firefox Rapid Release schedule. This document only covers merge activities,
not the related releases that happen on t">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-12-11T20:05:37Z">
<link href="../../../assets/css/tbrelease.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="dash">
  <div class="dash-nav dash-nav-dark">
    <header><a href="../../../" class="spur-logo">
          <img src="../../../images/thunderbird-watermark.svg" alt="Thunderbird Release Documentation" id="logo" class="d-inline-block align-top"></a>
    </header><nav class="dash-nav-list"><ul class="nav nav-pills flex-column">
<li class="dash-nav-item">
<a href="../../" class="nav-link">About Thunderbird Releases</a>
          </li>
<li class="dash-nav-item">
<a href="../../../dashboard/" class="nav-link">Release Dashboard</a>
          </li>
<li class="dash-nav-item">
<a href="../../../tools/" class="nav-link">Release Tools</a>
          </li>
<li class="dash-nav-item">
<a href="../../developers/" class="nav-link">Docs for Devs</a>
      </li>
<li class="dash-nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Docs for Drivers</a>
        <div class="dash-nav-dropdown-menu dropdown-menu">
              <a href="../" class="dash-nav-dropdown-item dropdown-item">Overview</a>
              <a href="../releasenotes/" class="dash-nav-dropdown-item dropdown-item">Release Notes</a>
              <a href="." class="dash-nav-dropdown-item dropdown-item active">Merge Day Automation <span class="sr-only">(active)</span></a>
              <a href="../mergeday_email_templates/" class="dash-nav-dropdown-item dropdown-item">Merge Emails</a>
        </div>
          </li>
<li class="dash-nav-item">
<a href="../../../areweesmifiedyet/" class="nav-link">Are We ESMified Yet?</a>

        
      </li>
</ul></nav>
</div>

  <div class="dash-app" id="content" role="main">
    <header class="dash-toolbar"><span>The reports of Thunderbird's death have been greatly exaggerated.</span>
      
    </header><!--Body content--><main class="dash-content"><div class="container-fluid">
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Merge Day Automation</a></h1>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <h2>Overview</h2>
<p>Merge day happens at 4-week intervals (most of the time), and follows the
Firefox Rapid Release schedule. This document only covers merge activities,
not the related releases that happen on the same day.</p>
<p>On Merge day:</p>
<ul>
<li>Communication about the merges</li>
<li>Merge comm-central to comm-beta</li>
<li>Tag and bump comm-central versions</li>
<li>Update ShipIt nightly version</li>
</ul>
<h2>Communication</h2>
<p>Send emails to both <a href="mailto:thunderbird-drivers@mozilla.org">thunderbird-drivers</a> and 
<a href="mailto:sheriffs@thunderbird.net">tb-sheriffs</a> list with information about the merge
and status updates. Templates are <a href="../mergeday_email_templates">here</a>.</p>
<h2>Steps</h2>
<p>Make sure you are logged into Treeherder. You will need to have
"thunderbird-releng" permissions, which are set in
<a href="https://hg.mozilla.org/ci/ci-configuration/file/1d37a3cf95a4e272eeaa7a910193e58ff2028646/grants.yml#l2415">Taskcluster</a>.</p>
<p>Close the <code>comm-central</code> and <code>comm-beta</code> trees in
<a href="https://treestatus.mozilla-releng.net/">TreeStatus</a>.</p>
<h3>comm-central -&gt; comm-beta</h3>
<ol>
<li>In Treeherder, select the comm-central repository</li>
<li>Select the Decision task of the latest push</li>
<li>Click the down arrow in the top right corner and select "Custom push action..."</li>
<li>Choose "merge-automation"</li>
<li>Update the payload &amp; trigger (note that with <code>force-dry-run</code> set to <code>true</code>, the value of
   <code>push</code> is ignored)</li>
</ol>
<div class="code"><pre class="code literal-block"><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">comm-central-to-beta</span>
<span class="nt">force-dry-run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>If the dry-run is successful, run it again, this time setting <code>force-dry-run</code> to
<code>false</code>.</p>
<h4>Update .gecko_rev.yml</h4>
<p>The automation will pin to mozilla-beta@default. This will build. A specific
revision needs to be pinned manually before releasing beta 1.</p>
<h4>Suite version</h4>
<p>The automation will change 2.XXa1 to 2.XXb1.</p>
<h3>Bump Daily version</h3>
<ol>
<li>Select comm-central repository in Treeherder and select the "merge-automation"
   custom action as above</li>
<li>Update the payload &amp; trigger</li>
</ol>
<div class="code"><pre class="code literal-block"><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">comm-bump-central</span>
<span class="nt">force-dry-run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">push</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>If the dry-run is successful, run again without <code>force-dry-run</code>.</p>
<p><strong>Note regarding suite version bump:</strong> This is now handled by automation so no
manual step is necessary.</p>
<h2>Update Ship-It</h2>
<p>Mozilla's <a href="https://github.com/mozilla-releng/shipit">Ship-It</a> tool must be
updated with the new Daily version number.</p>
<h3>Changes</h3>
<ul>
<li>Modify <code>api/src/shipit_api/common/config.py</code> and update the
  <code>LATEST_THUNDERBIRD_NIGHTLY_VERSION</code> variable to be the new version of
  comm-central.</li>
<li>Create a pull request with the changes. <a href="https://github.com/mozilla-releng/shipit/pull/1004">Example</a>
</li>
<li>In the pull request, @mention one of the Ship-It code owners to make sure
    the request is seen. You can also say something in #releaseduty on Matrix.</li>
</ul>
<p>If you are not familiar with Github's Fork &amp; Pull workflow model,
see <a href="https://reflectoring.io/github-fork-and-pull/">here</a> for an introduction.</p>
<h2>Check for Firefox Beta tag</h2>
<p>The build tag for the corresponding Firefox beta release may or may not have
been set yet. Check <code>mozilla-beta</code> for a tag like <code>FIREFOX_major_0b1_BUILD1</code>
where "major" is the new beta version.</p>
<p>If there is a tag, on a local "comm-beta" checkout: 
- run <code>pin_for_release.py mozilla-beta</code>.
- <code>hg amend -e</code> and add "CLOSED TREE" to the end of the first line of the
    commit message.
  - ex: <code>No bug - Pin mozilla-beta (FIREFOX_106_0b1_BUILD1/4f39db81f6e). r=release a=rjl CLOSED TREE</code>
- Push to comm-beta.</p>
<p>If the Firefox <code>BUILD1</code> tag has not been set, proceed with opening the trees
and the conclusion email, but remember to run <code>pin_for_release.py</code> prior to
promoting the Thunderbird Beta.</p>
<h2>Open Trees &amp; Conclusion Email</h2>
<p>If the builds running on <code>comm-central</code> and <code>comm-beta</code> look good, re-open
the trees. If there's a build or decision task failure, handle that before
opening the trees in TreeStatus.</p>
<p>Use the <a href="../mergeday_email_templates">Conclusion Email template</a> to notify
thunderbird-drivers that the work is complete.</p>
<h2>Test runs with a real push</h2>
<p>You can push to <code>try-comm-central</code> with to-repo/from-repo to test that pushing
actually works, though it really shouldn't break now that it's working.</p>
<h2>to-repo, from-repo, to-branch, from-branch?</h2>
<p>It's kind of confusing...</p>
<ul>
<li>to-branch and from-branch are Firefoxtree "branch" names, and correspond
  to "branches" of code for release purposes</li>
<li>
<strong>to-repo</strong> in a merge context is the URL of the destination repository you
  want to merge into. So for comm-central-to-beta, that's the <em>full URL</em> (https)
  of comm-beta on hg.m.o.</li>
<li>
<strong>from-repo</strong> then is the repo URL you are merging into to-repo. So, comm-central's
  URL.</li>
<li>
<strong>VERY IMPORTANT</strong> Merge day work will push to both <code>to-repo</code> and <code>from-repo</code>.
  So if you are testing push stuff, make sure to set both to <code>try-comm-central</code>'s
  URL.</li>
</ul>
</div>
    
</article>
</div>
    </main><!--End of body content--><footer id="footer"></footer>
</div>
</div>

            <script src="../../../assets/js/jquery.min.js"></script><script src="../../../assets/js/popper.min.js"></script><script src="../../../assets/js/bootstrap.min.js"></script><script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function (element) {
            return element.getElementsByTagName('img')[0].alt;
        }
    });
</script>
</body>
</html>
